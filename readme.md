26.12.2024
не забыть - добавлен костыль для более-менее удобного отображения оси У - 4
в void AbstractWaterfall::drawYLabels
ctx.painter->drawText(rect,Qt::AlignRight|Qt::AlignVCenter,
                                  QString::number(unitSign * (unit - 4)));
Корректно для настройки wf->setPandapterRange(-3.0, 33.0);


23.12.2024
добавление протокола MQTT 

папка analayzer_app - последняя рабочая версия приложения-драйвера
из последних изменений - убрана ошибка в сетке частот от 1ГГц до 6ГГц


#### настройки приложения в файле common-settings.h, комментарии в нем же.  
*Добавлено 6.12.24*
* в файл common-settings.h параметр WORK_MODE, задает опции в меню выключения. Влияет на файл closeDlg.cpp.
1. WORK_MODE = 0 - режим разработки, есть пункт закрытия приложения и выход на рабочий экран. 
2. WORK_MODE = 1 - боевой режим, нет пункта закрытия приложения. Пользователь может перезагрузить ОС или выключить Оранж.  
*Добавлено 23.12.24*
1. добавлены настройки для MQTT

*Добавлено 24.01.25*
Путь к драйверу и раб директории в файле config.bin
* APP_PATH - драйвер сдр
* WORK_DIR - его раб директория
  
Настройки MQTT в файле config.bin
Путь к файлу звука в файле config.bin
Путь к файлу к файлу пользовательских настроек в файле config.bin

#### Запуск приложения
При запуске ГУИ, запускается драйвер - в этот момент на приборе должны загореться индикаторы ПРИЕМНИК и КРОСС зеленым цветом. Нажатие кнопки режима (Лора или Видео) в первый раз устанавливается соединение по вебсокету с драйвером (при успешном соединении загорается зеленым индикатор ДРАЙВЕР), после этого стратует выбранный режим.
На ПК индикатор КРОСС всегда красный.

#### Звук
По звуку - вывзов звукового оповещения для лоры после строчки qDebug() << "LORA DETECTED"; файл detector.cpp, метод void Detector::newLoraDetectedSignals(QList<QList<uint32_t> > newLoraSignals)

вызов звука для видео - добавлена команда в метод void Detector::addItemToList(uint32_t freq, uint32_t marker) this->playSound();
если в настройках звук активен, будет проигрываться звук и наоборот


#### Соответствие кнопок на приборе (сверху вниз, слева направо) и названий:

* 1 - Close (в текущей версии служит для закрытия ГУИ и остановки работы драйвера)
* 2 - TAB
* 3 - Units, переключение шага изменения параметров диапазона, 1, 10, 100 МГц
* 4 - Очистка списков
* 5 - Settings, вызов/закрытие окна с настройками режимов 

* 6 - энкодер, инкремент/декремент параметров с заданным шагом, нажатие - ввод пар-ра
* 7  - ModeA (лора)
* 8  - ModeB (видео)
* 9  - ModeC (спектр с накоплением)
* 10 - незадействовано

#### Конфигурация



#### Настройки
Настройки по умолчанию загружаются из файла seettings.bin. Исходный файл в папке resourses, на приборе доступен только для чтения из приложения.
* static QString DEFAULT_SETTINGS_FILE - по умолчанию
* static QString USER_SETTINGS_FILE - пользовательские, могут быть отредактированы вне приложения. Поля по умолчанию меняться не должны. Могут быть добавлены другие поля, но в приложении они не будут учитываться.

Пользовательские загружаются в приоритете, если они существуют. При возврате к настройкам по умолчанию файл с пользовательскими настройками удаляется. Кнопка с шестеренкой выбирает настройки по умолчанию или последние записанные пользовательские.

Кнопка (крайняя правая) для записи файла настроек пользователя. Старая будет служить для переключения с пользовательских на дефолтные. 

При выборе окна настроек для режима, при повторном нажатии на выбранный режим фокус передается на кнопку записи новых настроек.

#### Программное выключение
При нажатии на мех.кнопку Close выводится меню с опциями закрытия приложения(в боевом не будет), выкл и перезагрузки. Выбор по табу, активация - нажатие на энкодер.
Мех кнопку на оранже использовать не будем, будет кнопка с фиксацией в цепи питания.


*Конструктивные изменения на перспективу*

1. Сигнализация выключения питания пк для организации безопасного выключения основного питания внешней кнопокой.  
На кросс-плате реализовать формирование сигнала, иммитирующего длинное нажатие кнопки питания оранжа, запуск при приеме команды от ГУИ.  
Добавить контроль линии питания 3.3 В на двухрядном разъеме оранжа, отсутствие питания сигнализирует о выключении оранжа.  
Управление динамиком через коммутатор для возможности сигнализации через кросс-плату о системых событиях, связанных с вкл/выключением питания оранжа.   

*Проблемы ПО для исправления*
1. не меняется в режиме видео пар-ры диапазона сканирования на метке после обновления в настройках без нажатия на кнопку режима. 

*Задачи по корректировке на перспективу*
1. зациклить режимы сканирования видео по сетке на стороне драйвера, чтобы не тащить зависимости по граничым частотам на верхний уровень - ? 
2. добавить команду для предустановки частоты сдр, чтобы можно было бы четко выставлять КУ. 

*Непонятные особенности, которые надо учитывать на целевой плате*

1. Столкнулись с проблемой наименования папки драйвера - "-" в наименовании не использовать! Могут быть проблемы, может работать, может не работать путь в котором используется дефис.